{"version":3,"sources":["pages/Checkout.jsx","actions/cartActions.js","functions/user.js"],"names":["Checkout","history","useState","loading","setLoading","products","setProducts","total","setTotal","address","setAddress","savedAddress","setSavedAddress","coupon","setCoupon","totalAfterDiscount","setTotalAfterDiscount","discountError","setDiscountError","user","useSelector","state","dispatch","useDispatch","saveAddressToDB","saveUserAddress","token","then","response","toast","success","catch","err","console","log","error","message","useEffect","getUserCart","cart","data","cartTotal","applyDiscountCoupon","applyCoupon","toUpperCase","applyCouponAction","handleCouponInput","e","target","value","className","theme","onChange","onClick","type","length","map","prod","product","title","color","count","price","_id","push","disabled","removeUserCart","emptyUserCart","addProductToCart","item","getState","ADD_TO_CART","payload","window","localStorage","setItem","JSON","stringify","removeProductToCart","REMOVE_FROM_CART","removeItem","EMPTY_CART","userCart","authtoken","a","axios","post","process","headers","get","delete","name","createOrder","stripeResponse","getUserOrders","getWishlist","addToWishlist","productId","removeWishlist"],"mappings":"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","file":"static/js/37.c94cbc87.chunk.js","sourcesContent":["import { LoadingOutlined } from '@ant-design/icons';\nimport React, { useEffect, useState } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { toast } from 'react-toastify';\nimport { removeUserCart } from '../actions/cartActions';\nimport { applyCouponAction } from '../actions/userActions';\nimport { applyCoupon, emptyUserCart, getUserCart, saveUserAddress } from '../functions/user';\nimport ReactQuill from 'react-quill';\nimport 'react-quill/dist/quill.snow.css';\n\nfunction Checkout({ history }) {\n    const [loading, setLoading] = useState(false);\n    const [products, setProducts] = useState([]);\n    const [total, setTotal] = useState(0);\n    const [address, setAddress] = useState('');\n    const [savedAddress, setSavedAddress] = useState(false);\n    const [coupon, setCoupon] = useState('');\n    const [totalAfterDiscount, setTotalAfterDiscount] = useState(0);\n    const [discountError, setDiscountError] = useState('');\n\n    const user = useSelector(state => state.user)\n    const dispatch = useDispatch();\n\n    const saveAddressToDB = () => {\n        saveUserAddress(user.token, address)\n            .then(response => {\n                setSavedAddress(true);\n                toast.success('Address saved')\n            })\n            .catch(err => {\n                console.log(err);\n                toast.error(err.message)\n            })\n    };\n\n    const emptyCart = () => {\n        dispatch(removeUserCart());\n        emptyUserCart(user.token)\n            .then(response => {\n                setProducts([]);\n                setTotal(0);\n                setTotalAfterDiscount(0);\n                setCoupon('');\n                toast.success('Cart is empty. Continue shopping')\n            })\n            .catch(response => console.log(response))\n    };\n\n    useEffect(() => {\n        setLoading(true);\n        getUserCart(user.token)\n            .then(cart => {\n                setLoading(false);\n                const { products, cartTotal } = cart.data;\n                setProducts(products);\n                setTotal(cartTotal);\n            })\n            .catch(err => {\n                setLoading(false);\n                console.log(err)\n            })\n    }, [user.token]);\n\n    const applyDiscountCoupon = () => {\n        applyCoupon(coupon.toUpperCase(), user.token)\n            .then(response => {\n                console.log(response.data);\n                if (response.data) {\n                    setTotalAfterDiscount(response.data.totalAfterDiscount);\n                    dispatch(applyCouponAction(true));\n                }\n                if (response.data.err) {\n                    setDiscountError(response.data.err);\n                    dispatch(applyCouponAction(false))\n                }\n            })\n            .catch(err => console.log(err));\n    }\n\n    const handleCouponInput = (e) => {\n        setDiscountError('')\n        setCoupon((e.target.value))\n    }\n\n    const showAddress = () => <div className='mb-5'>\n        <ReactQuill\n            theme=\"snow\"\n            value={address}\n            onChange={setAddress} />\n        <button\n            className='btn btn-primary btn-raised mt-2'\n            onClick={saveAddressToDB}\n        >\n            Save\n                </button>\n    </div>\n\n    const showProductSummary = () =>\n        products.map((prod) =>\n            <div key={prod._id} className='row'>\n                <p className='col-md-7'>{prod.product.title}{\" \"}</p>\n                <p className='col-md-2'>({prod.color} x {prod.count}){\" \"}</p>\n                <p className='col-md-1'>={\" \"}</p>\n                <p className='col-md-1'>{prod.product.price * prod.count}</p>\n            </div>\n        )\n\n    const showApplyCoupon = () => <>\n        <input type=\"text\"\n            onChange={handleCouponInput}\n            value={coupon}\n            className='form-control'\n        />\n        <button onClick={applyDiscountCoupon}\n            className='btn btn-primary btn-raised mt-2'\n        >\n            Apply\n        </button>\n    </>\n\n    return (\n        <div className='container-fluid'>\n            { loading\n                ? <h4 className='pt-2'><LoadingOutlined />Loading ...</h4>\n                : <div className='row pt-2'>\n                    <div className='col-md-6'>\n                        <h4>Delivery Address</h4>\n                        {showAddress()}\n                        <h4>Got Coupon</h4>\n                        {showApplyCoupon()}\n                        {discountError && <p className='bg-danger p-2'>{discountError}</p>}\n                    </div>\n                    <div className='col-md-6'>\n                        <h4 className='mb-2'>Order Summary</h4>\n                        <p>Products: {products.length}</p>\n                        {showProductSummary()}\n                        <p>Cart Total: {total}</p>\n                        {totalAfterDiscount > 0 && (\n                            <p className='bg-success p-2'>\n                                <strong>Discount Applied: Total Payable: </strong>${totalAfterDiscount}\n                            </p>\n                        )}\n                        <div className='row'>\n                            <div className='col-md-6'>\n                                <button\n                                    onClick={() => history.push('/payment')}\n                                    disabled={!savedAddress || !products.length}\n                                    className='btn btn-primary'>Place Order</button>\n                            </div>\n                            <div className='col-md-6'>\n                                <button\n                                    className='btn btn-primary'\n                                    disabled={!products.length}\n                                    onClick={emptyCart}>\n                                    Empty Order\n                            </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            }\n        </div>\n    )\n}\n\nexport default Checkout\n","import { ADD_TO_CART, EMPTY_CART, REMOVE_FROM_CART} from \"../constants\";\n\nexport const addProductToCart = (item) => (dispatch, getState) => {\n    dispatch({\n        type: ADD_TO_CART,\n        payload: item\n    })\n    console.log('object', getState().cart)\n    if (typeof window !== 'undefined') {\n        localStorage.setItem('cart', JSON.stringify(getState().cart));\n    }\n};\n\nexport const removeProductToCart = (item) => (dispatch, getState) => {\n    dispatch({\n        type: REMOVE_FROM_CART,\n        payload: item\n    })\n    console.log('object', getState().cart)\n    if (typeof window !== 'undefined') {\n        localStorage.setItem('cart', JSON.stringify(getState().cart));\n    }\n};\n\nexport const removeUserCart = () => (dispatch) => {\n    if (typeof window !== 'undefined') {\n        localStorage.removeItem('cart');\n    }\n    dispatch({\n        type: EMPTY_CART,\n        payload: [],\n    })\n}","import axios from \"axios\";\n\nexport const userCart = async (cart, authtoken) => {\n    return await axios.post(`${process.env.REACT_APP_API}/user/cart`,\n        { cart },\n        { headers: { authtoken } })\n};\n\nexport const getUserCart = async (authtoken) => {\n    return await axios.get(`${process.env.REACT_APP_API}/user/cart`,\n        { headers: { authtoken } })\n};\n\nexport const emptyUserCart = async (authtoken) => {\n    return await axios.delete(`${process.env.REACT_APP_API}/user/cart`,\n        { headers: { authtoken } })\n};\n\nexport const saveUserAddress = async (authtoken, address) => {\n    return await axios.post(`${process.env.REACT_APP_API}/user/address`,\n        { address },\n        { headers: { authtoken } })\n};\n\nexport const applyCoupon = async (coupon, authtoken) => {\n    return await axios.post(`${process.env.REACT_APP_API}/user/cart/coupon`,\n        { name: coupon },\n        {\n            headers: { authtoken }\n        })\n};\n\nexport const createOrder = async (stripeResponse, authtoken) => {\n    return await axios.post(`${process.env.REACT_APP_API}/user/order`,\n        { stripeResponse },\n        {\n            headers: { authtoken }\n        })\n};\n\nexport const getUserOrders = async (authtoken) => {\n    return await axios.get(`${process.env.REACT_APP_API}/user/order`,\n        {\n            headers: { authtoken }\n        })\n};\n\nexport const getWishlist = async (authtoken) => {\n    return await axios.get(`${process.env.REACT_APP_API}/user/wishlist`,\n        {\n            headers: { authtoken }\n        })\n};\n\nexport const addToWishlist = async (productId, authtoken) => {\n    return await axios.post(`${process.env.REACT_APP_API}/user/wishlist`,\n        { productId },\n        {\n            headers: { authtoken }\n        })\n};\n\nexport const removeWishlist = async (productId, authtoken) => {\n    return await axios.post(`${process.env.REACT_APP_API}/user/wishlist/${productId}`, \n    {},\n    {\n        headers: { authtoken }\n    })\n};"],"sourceRoot":""}
{"version":3,"sources":["pages/Checkout.jsx","actions/cartActions.js","functions/user.js"],"names":["Checkout","history","useState","loading","setLoading","products","setProducts","total","setTotal","address","setAddress","savedAddress","setSavedAddress","coupon","setCoupon","totalAfterDiscount","setTotalAfterDiscount","discountError","setDiscountError","user","useSelector","state","dispatch","useDispatch","saveAddressToDB","saveUserAddress","token","then","response","toast","success","catch","err","console","log","error","message","useEffect","getUserCart","cart","data","cartTotal","orderedBy","applyDiscountCoupon","applyCoupon","toUpperCase","applyCouponAction","handleCouponInput","e","target","value","className","noAddress","replace","theme","formats","onChange","onClick","showAddress","type","length","map","prod","product","title","color","count","price","_id","push","disabled","style","pointerEvents","removeUserCart","emptyUserCart","addProductToCart","item","getState","ADD_TO_CART","payload","window","localStorage","setItem","JSON","stringify","removeProductToCart","REMOVE_FROM_CART","removeItem","EMPTY_CART","userCart","authtoken","a","axios","post","process","headers","get","delete","name","createOrder","stripeResponse","getUserOrders","getWishlist","addToWishlist","productId","removeWishlist"],"mappings":"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","file":"static/js/37.ed6736df.chunk.js","sourcesContent":["import { LoadingOutlined } from '@ant-design/icons';\nimport React, { useEffect, useState } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { toast } from 'react-toastify';\nimport { removeUserCart } from '../actions/cartActions';\nimport { applyCouponAction } from '../actions/userActions';\nimport { applyCoupon, emptyUserCart, getUserCart, saveUserAddress } from '../functions/user';\nimport ReactQuill from 'react-quill';\nimport 'react-quill/dist/quill.snow.css';\n\nfunction Checkout({ history }) {\n    const [loading, setLoading] = useState(false);\n    const [products, setProducts] = useState([]);\n    const [total, setTotal] = useState(0);\n    const [address, setAddress] = useState('');\n    const [savedAddress, setSavedAddress] = useState(false);\n    const [coupon, setCoupon] = useState('');\n    const [totalAfterDiscount, setTotalAfterDiscount] = useState(0);\n    const [discountError, setDiscountError] = useState('');\n\n    const user = useSelector(state => state.user)\n    const dispatch = useDispatch();\n\n    const saveAddressToDB = () => {\n        saveUserAddress(user.token, address)\n            .then(response => {\n                setSavedAddress(true);\n                toast.success('Address saved')\n            })\n            .catch(err => {\n                console.log(err);\n                toast.error(err.message)\n            })\n    };\n\n    const emptyCart = () => {\n        dispatch(removeUserCart());\n        emptyUserCart(user.token)\n            .then(response => {\n                setProducts([]);\n                setTotal(0);\n                setTotalAfterDiscount(0);\n                setCoupon('');\n                toast.success('Cart is empty. Continue shopping')\n            })\n            .catch(response => console.log(response))\n    };\n\n    useEffect(() => {\n        setLoading(true);\n        getUserCart(user.token)\n            .then(cart => {\n                setLoading(false);\n                const { products, cartTotal, orderedBy } = cart.data;\n                setProducts(products);\n                setTotal(cartTotal);\n                setAddress(orderedBy.address)\n            })\n            .catch(err => {\n                setLoading(false);\n                console.log(err)\n            })\n    }, [user.token]);\n\n    const applyDiscountCoupon = () => {\n        applyCoupon(coupon.toUpperCase(), user.token)\n            .then(response => {\n                if (response.data) {\n                    setTotalAfterDiscount(response.data.totalAfterDiscount);\n                    dispatch(applyCouponAction(true));\n                }\n                if (response.data.err) {\n                    setDiscountError(response.data.err);\n                    dispatch(applyCouponAction(false))\n                }\n            })\n            .catch(err => console.log(err));\n    }\n\n    const handleCouponInput = (e) => {\n        setDiscountError('')\n        setCoupon((e.target.value))\n    }\n\n    const showAddress = () => {\n        const noAddress = address.replace(/<[^>]+>/g, '') === \"\";\n\n        return <div className='mb-5'>\n            <ReactQuill\n                theme=\"snow\"\n                formats='bold'\n                value={address}\n                onChange={setAddress} />\n            <button className='btn btn-primary btn-raised mt-2' onClick={saveAddressToDB}>\n                {noAddress ? 'Save' : 'Confirm'}\n            </button>\n            {noAddress ? <span>{\" \"} Please enter your address</span> : <span>{\" \"} Please confirm your address</span>}\n        </div>\n    }\n\n    const showProductSummary = () =>\n        products.map((prod) =>\n            <div key={prod._id} className='row'>\n                <p className='col-md-7'>{prod.product.title}{\" \"}</p>\n                <p className='col-md-2'>({prod.color} x {prod.count}){\" \"}</p>\n                <p className='col-md-1'>={\" \"}</p>\n                <p className='col-md-1'>{prod.product.price * prod.count}</p>\n            </div>\n        )\n\n    const showApplyCoupon = () => <>\n        <input type=\"text\"\n            onChange={handleCouponInput}\n            value={coupon}\n            className='form-control'\n        />\n        <button onClick={applyDiscountCoupon}\n            className='btn btn-primary btn-raised mt-2'\n        >\n            Apply\n        </button>\n    </>\n\n    return (\n        <div className='container-fluid'>\n            { loading\n                ? <h4 className='pt-2'><LoadingOutlined />Loading ...</h4>\n                : <div className='row pt-2'>\n                    <div className='col-md-6'>\n                        <h4>Delivery Address</h4>\n                        {showAddress()}\n                        <h4>Got Coupon</h4>\n                        {showApplyCoupon()}\n                        {discountError && <p className='bg-danger p-2'>{discountError}</p>}\n                    </div>\n                    <div className='col-md-6'>\n                        <h4 className='mb-2'>Order Summary</h4>\n                        <p>Products: {products.length}</p>\n                        {showProductSummary()}\n                        <p>Cart Total: {total}</p>\n                        {totalAfterDiscount > 0 && (\n                            <p className='bg-success p-2'>\n                                <strong>Discount Applied: Total Payable: </strong>${totalAfterDiscount}\n                            </p>\n                        )}\n                        <div className='row'>\n                            <div className='col-md-6'>\n                                <button\n                                    onClick={() => history.push('/payment')}\n                                    disabled={!savedAddress || !products.length}\n                                    style={{ pointerEvents: !savedAddress || !products.length && \"none\" }}\n                                    className='btn btn-primary btn-raised'>Place Order</button>\n                            </div>\n                            <div className='col-md-6'>\n                                <button\n                                    className='btn btn-primary'\n                                    disabled={!products.length}\n                                    onClick={emptyCart}>\n                                    Empty Order\n                            </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            }\n        </div>\n    )\n}\n\nexport default Checkout\n","import { ADD_TO_CART, EMPTY_CART, REMOVE_FROM_CART} from \"../constants\";\n\nexport const addProductToCart = (item) => (dispatch, getState) => {\n    dispatch({\n        type: ADD_TO_CART,\n        payload: item\n    })\n    if (typeof window !== 'undefined') {\n        localStorage.setItem('cart', JSON.stringify(getState().cart));\n    }\n};\n\nexport const removeProductToCart = (item) => (dispatch, getState) => {\n    dispatch({\n        type: REMOVE_FROM_CART,\n        payload: item\n    })\n    if (typeof window !== 'undefined') {\n        localStorage.setItem('cart', JSON.stringify(getState().cart));\n    }\n};\n\nexport const removeUserCart = () => (dispatch) => {\n    if (typeof window !== 'undefined') {\n        localStorage.removeItem('cart');\n    }\n    dispatch({\n        type: EMPTY_CART,\n        payload: [],\n    })\n}","import axios from \"axios\";\n\nexport const userCart = async (cart, authtoken) => {\n    return await axios.post(`${process.env.REACT_APP_API}/user/cart`,\n        { cart },\n        { headers: { authtoken } })\n};\n\nexport const getUserCart = async (authtoken) => {\n    return await axios.get(`${process.env.REACT_APP_API}/user/cart`,\n        { headers: { authtoken } })\n};\n\nexport const emptyUserCart = async (authtoken) => {\n    return await axios.delete(`${process.env.REACT_APP_API}/user/cart`,\n        { headers: { authtoken } })\n};\n\nexport const saveUserAddress = async (authtoken, address) => {\n    return await axios.post(`${process.env.REACT_APP_API}/user/address`,\n        { address },\n        { headers: { authtoken } })\n};\n\nexport const applyCoupon = async (coupon, authtoken) => {\n    return await axios.post(`${process.env.REACT_APP_API}/user/cart/coupon`,\n        { name: coupon },\n        {\n            headers: { authtoken }\n        })\n};\n\nexport const createOrder = async (stripeResponse, authtoken) => {\n    return await axios.post(`${process.env.REACT_APP_API}/user/order`,\n        { stripeResponse },\n        {\n            headers: { authtoken }\n        })\n};\n\nexport const getUserOrders = async (authtoken) => {\n    return await axios.get(`${process.env.REACT_APP_API}/user/order`,\n        {\n            headers: { authtoken }\n        })\n};\n\nexport const getWishlist = async (authtoken) => {\n    return await axios.get(`${process.env.REACT_APP_API}/user/wishlist`,\n        {\n            headers: { authtoken }\n        })\n};\n\nexport const addToWishlist = async (productId, authtoken) => {\n    return await axios.post(`${process.env.REACT_APP_API}/user/wishlist`,\n        { productId },\n        {\n            headers: { authtoken }\n        })\n};\n\nexport const removeWishlist = async (productId, authtoken) => {\n    return await axios.post(`${process.env.REACT_APP_API}/user/wishlist/${productId}`, \n    {},\n    {\n        headers: { authtoken }\n    })\n};"],"sourceRoot":""}